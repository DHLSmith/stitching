Executed at 2025-03-26_14-51-53
logging to ./results_2n/2025-03-26_14-51-53_SEED13_EPOCHS4_BGN0.1_exp2e_ResNet18_log.txt
seed=13
bg_noise=0.1
gen_randinit_model=False
randinit_model_to_load='./results_2m/2025-03-26_12-06-31_SEED57_EPOCHS4_BGN0.1_exp2e_ResNet18_randinit.weights'
train_mix_mnist_model=False
mix_mnist_model_to_load='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_mix_mnist.weights'
train_bw_mnist_model=False
bw_mnist_model_to_load='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bw_mnist.weights'
train_bg_only_colour_mnist_model=False
bg_only_colour_mnist_model_to_load='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist.weights'
train_bg_unbiased_colour_mnist_model=False
bg_unbiased_colour_mnist_model_to_load='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_unbiased_colour_mnist.weights'
train_biased_colour_mnist_model=False
biased_colour_mnist_model_to_load='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_biased_colour_mnist.weights'
train_unbiased_colour_mnist_model=False
unbiased_colour_mnist_model_to_load='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_unbiased_colour_mnist.weights'
stitch_train_epochs=10
================================================
val['loadfrom']='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bw_mnist.weights'
val['loadfrom']='./results_4_epochs/2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist.weights'
val['loadfrom']='./results_2m/2025-03-26_12-06-31_SEED57_EPOCHS4_BGN0.1_exp2e_ResNet18_randinit.weights'
Entering Confusion
Accuracy Calculation for ResNet18 with key='bw'
Test the Trained Resnet18 against OWN TEST LOADER: key='bw'
Test Accuracy: 99.09 %
Confusion Matrix
tensor([[ 979,    0,    0,    0,    0,    1,    0,    0,    0,    0],
        [   0, 1132,    0,    0,    0,    2,    1,    0,    0,    0],
        [   1,    1, 1025,    3,    1,    0,    0,    1,    0,    0],
        [   1,    0,    0, 1000,    0,    5,    0,    0,    3,    1],
        [   0,    0,    0,    0,  973,    0,    0,    1,    0,    8],
        [   2,    0,    0,    1,    0,  881,    1,    0,    2,    5],
        [   3,    4,    0,    0,    0,    2,  948,    0,    1,    0],
        [   0,    5,    9,    2,    0,    0,    0, 1006,    1,    5],
        [   3,    0,    1,    0,    0,    1,    0,    2,  965,    2],
        [   1,    1,    0,    2,    3,    1,    0,    0,    1, 1000]],
       dtype=torch.int32)
tensor(10000)
Accuracy Calculation for ResNet18 with key='bgonly'
Test the Trained Resnet18 against OWN TEST LOADER: key='bgonly'
Test Accuracy: 100.00 %
Confusion Matrix
tensor([[ 980,    0,    0,    0,    0,    0,    0,    0,    0,    0],
        [   0, 1135,    0,    0,    0,    0,    0,    0,    0,    0],
        [   0,    0, 1032,    0,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0, 1010,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0,    0,  982,    0,    0,    0,    0,    0],
        [   0,    0,    0,    0,    0,  892,    0,    0,    0,    0],
        [   0,    0,    0,    0,    0,    0,  958,    0,    0,    0],
        [   0,    0,    0,    0,    0,    0,    0, 1028,    0,    0],
        [   0,    0,    0,    0,    0,    0,    0,    0,  974,    0],
        [   0,    0,    0,    0,    0,    0,    0,    0,    0, 1009]],
       dtype=torch.int32)
tensor(10000)
Accuracy Calculation for ResNet18 with key='randinit'
Test the Trained Resnet18 against OWN TEST LOADER: key='randinit'
Test Accuracy: 10.10 %
Confusion Matrix
tensor([[   0,    1,    0,  977,    0,    0,    2,    0,    0,    0],
        [   0,    0,    0, 1123,    0,    0,   12,    0,    0,    0],
        [   0,    1,    0, 1025,    0,    0,    6,    0,    0,    0],
        [   0,    0,    0, 1010,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0,  982,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0,  892,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0,  958,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0, 1028,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0,  974,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0, 1009,    0,    0,    0,    0,    0,    0]],
       dtype=torch.int32)
tensor(10000)
original_accuracy={'bw': 99.09, 'bgonly': 100.0, 'randinit': 10.1}
Entering whole model check
Measure Rank for key='bw'
Measure Rank for key='bgonly'
Measure Rank for key='randinit'
Entering Stitch/Rank
device='cuda:0'
NOTE: Only running stitch to bgonly: skipping
Evaluate ranks and output to ./results_2n_rank/bw3bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 3 from bw to bgonly
Use the bw data loader (train and test) regardless of what bgonly was trained on
Epoch 0, loss 2861.86
Epoch 1, loss 1150.09
Epoch 2, loss 759.37
Epoch 3, loss 586.38
Epoch 4, loss 509.07
Epoch 5, loss 463.61
Epoch 6, loss 429.69
Epoch 7, loss 395.07
Epoch 8, loss 365.17
Epoch 9, loss 342.73
**** Finished Training ****
Change in stitch weights: 2.599771022796631
Largest abs weight change: 0.18312577903270721
Number of weights changing > 0.1 of that: 2573
Change in stitch bias: 0.02668709121644497
Largest abs bias change: 0.005677767097949982
Number of bias changing > 0.1 of that: 57
Test the trained stitch against key='randinit' data
Test Accuracy: 86.53 %
Confusion Matrix
tensor([[ 843,    0,   21,    0,   36,    0,   35,   39,    5,    1],
        [   1, 1089,    3,    4,   33,    0,    3,    1,    0,    1],
        [   1,    1,  927,    5,    8,    1,   30,   20,   39,    0],
        [   0,    0,   35,  899,    6,    2,    0,    3,   64,    1],
        [   4,   34,    0,    3,  839,    0,   32,   38,   24,    8],
        [   0,    3,   12,   15,   53,  721,    2,    1,   57,   28],
        [  10,    3,    4,    0,   14,    2,  905,    0,   20,    0],
        [   6,    1,   37,    5,   50,    0,    8,  855,   45,   21],
        [   0,    9,   60,   26,   14,    1,   37,    5,  783,   39],
        [   1,    3,    6,    6,   26,    3,    9,   55,  108,  792]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/bw4bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 4 from bw to bgonly
Use the bw data loader (train and test) regardless of what bgonly was trained on
Epoch 0, loss 2190.38
Epoch 1, loss 691.32
Epoch 2, loss 530.95
Epoch 3, loss 445.03
Epoch 4, loss 266.30
Epoch 5, loss 210.77
Epoch 6, loss 179.40
Epoch 7, loss 160.76
Epoch 8, loss 149.62
Epoch 9, loss 140.11
**** Finished Training ****
Change in stitch weights: 2.335005760192871
Largest abs weight change: 0.15392860770225525
Number of weights changing > 0.1 of that: 2700
Change in stitch bias: 0.026690848171710968
Largest abs bias change: 0.005648411810398102
Number of bias changing > 0.1 of that: 58
Test the trained stitch against key='randinit' data
Test Accuracy: 94.27 %
Confusion Matrix
tensor([[ 919,    0,    0,    0,   25,    0,   19,   17,    0,    0],
        [   0, 1110,    2,    3,    7,    0,    8,    0,    5,    0],
        [   4,    1,  965,    4,    5,    0,    9,   35,    9,    0],
        [   0,    0,    5,  972,    6,   11,    0,    4,   11,    1],
        [   3,    4,    0,    0,  920,    0,   12,   19,   13,   11],
        [   0,    6,    4,    9,   28,  815,    3,    0,   19,    8],
        [   5,   13,    3,    0,   11,    1,  923,    0,    2,    0],
        [   1,    2,    8,    8,   17,    0,    1,  981,    6,    4],
        [   0,    0,   17,   11,   10,    2,   14,    9,  907,    4],
        [   1,    1,    1,    3,   20,    0,    1,   26,   41,  915]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/bw5bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 5 from bw to bgonly
Use the bw data loader (train and test) regardless of what bgonly was trained on
Epoch 0, loss 651.76
Epoch 1, loss 84.17
Epoch 2, loss 59.75
Epoch 3, loss 52.08
Epoch 4, loss 44.45
Epoch 5, loss 41.07
Epoch 6, loss 37.29
Entering Stitch/Rank
device='cuda:0'
NOTE: Only running stitch to bgonly: skipping
Already evaluated for ./results_2n_rank/bw3bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Already evaluated for ./results_2n_rank/bw4bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Evaluate ranks and output to ./results_2n_rank/bw5bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 5 from bw to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Entering Stitch/Rank
device='cuda:0'
NOTE: Only running stitch to bgonly: skipping
Already evaluated for ./results_2n_rank/bw3bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Already evaluated for ./results_2n_rank/bw4bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Evaluate ranks and output to ./results_2n_rank/bw5bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 5 from bw to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 568.72
Epoch 1, loss 79.85
Epoch 2, loss 61.32
Epoch 3, loss 53.73
Epoch 4, loss 47.47
Epoch 5, loss 43.50
Epoch 6, loss 41.22
Epoch 7, loss 38.16
Epoch 8, loss 34.53
Epoch 9, loss 33.05
**** Finished Training ****
Change in stitch weights: 1.3868497610092163
Largest abs weight change: 0.06497176736593246
Number of weights changing > 0.1 of that: 8660
Change in stitch bias: 0.02655002847313881
Largest abs bias change: 0.003988742828369141
Number of bias changing > 0.1 of that: 111
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 98.34 %
Confusion Matrix
tensor([[ 969,    0,    0,    0,    4,    1,    4,    2,    0,    0],
        [   0, 1119,    1,    4,    6,    0,    3,    0,    2,    0],
        [   1,    1, 1011,    3,    3,    0,    3,    6,    4,    0],
        [   0,    1,    0, 1001,    2,    4,    0,    0,    2,    0],
        [   0,    1,    1,    0,  969,    0,    1,    3,    4,    3],
        [   1,    0,    0,    7,    3,  876,    2,    1,    0,    2],
        [   8,    2,    1,    1,   10,    1,  933,    0,    2,    0],
        [   0,    1,    4,    2,    4,    0,    0, 1015,    0,    2],
        [   0,    0,    3,    0,    7,    0,    3,    3,  955,    3],
        [   0,    0,    0,    2,    4,    4,    1,    6,    6,  986]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/bw6bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 6 from bw to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 192.16
Epoch 1, loss 26.29
Epoch 2, loss 22.96
Epoch 3, loss 19.97
Epoch 4, loss 17.96
Epoch 5, loss 16.82
Epoch 6, loss 15.98
Epoch 7, loss 15.03
Epoch 8, loss 14.48
Epoch 9, loss 14.15
**** Finished Training ****
Change in stitch weights: 0.9292250275611877
Largest abs weight change: 0.030461296439170837
Number of weights changing > 0.1 of that: 22252
Change in stitch bias: 0.025887615978717804
Largest abs bias change: 0.002849448472261429
Number of bias changing > 0.1 of that: 233
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 99.04 %
Confusion Matrix
tensor([[ 974,    0,    0,    0,    0,    1,    2,    1,    1,    1],
        [   0, 1124,    3,    2,    3,    0,    1,    1,    1,    0],
        [   0,    0, 1025,    1,    1,    0,    0,    4,    1,    0],
        [   0,    0,    1, 1005,    1,    2,    0,    0,    1,    0],
        [   0,    0,    3,    0,  974,    0,    0,    1,    0,    4],
        [   2,    0,    0,    5,    0,  882,    1,    0,    0,    2],
        [   2,    3,    1,    0,    1,    2,  948,    0,    1,    0],
        [   0,    1,    3,    1,    2,    0,    0, 1016,    1,    4],
        [   2,    0,    2,    1,    0,    1,    0,    2,  964,    2],
        [   2,    0,    0,    2,    5,    2,    0,    3,    3,  992]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/bw7bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 7 from bw to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 67.91
Epoch 1, loss 14.86
Epoch 2, loss 12.72
Epoch 3, loss 11.28
Epoch 4, loss 11.22
Epoch 5, loss 10.16
Epoch 6, loss 9.92
Epoch 7, loss 9.73
Epoch 8, loss 9.59
Epoch 9, loss 9.48
**** Finished Training ****
Change in stitch weights: 0.8661821484565735
Largest abs weight change: 0.01640220358967781
Number of weights changing > 0.1 of that: 83044
Change in stitch bias: 0.02557258866727352
Largest abs bias change: 0.0020101964473724365
Number of bias changing > 0.1 of that: 462
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 99.18 %
Confusion Matrix
tensor([[ 977,    0,    1,    0,    0,    0,    0,    1,    1,    0],
        [   0, 1129,    1,    2,    0,    1,    1,    1,    0,    0],
        [   0,    0, 1025,    2,    1,    0,    0,    4,    0,    0],
        [   0,    0,    1, 1003,    0,    3,    0,    0,    2,    1],
        [   0,    0,    0,    0,  975,    0,    0,    2,    0,    5],
        [   2,    0,    0,    5,    0,  878,    1,    0,    1,    5],
        [   2,    3,    0,    0,    2,    2,  948,    0,    1,    0],
        [   0,    2,    2,    0,    1,    0,    0, 1020,    1,    2],
        [   1,    0,    1,    0,    0,    1,    0,    2,  968,    1],
        [   1,    0,    0,    2,    4,    1,    0,    2,    4,  995]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/bw8bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 8 from bw to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 59.95
Epoch 1, loss 15.90
Epoch 2, loss 13.13
Epoch 3, loss 11.81
Epoch 4, loss 11.26
Epoch 5, loss 10.93
Epoch 6, loss 10.30
Epoch 7, loss 9.97
Epoch 8, loss 9.77
Epoch 9, loss 9.66
**** Finished Training ****
Change in stitch weights: 0.8558763265609741
Largest abs weight change: 0.016653679311275482
Number of weights changing > 0.1 of that: 79104
Change in stitch bias: 0.027401268482208252
Largest abs bias change: 0.0020089708268642426
Number of bias changing > 0.1 of that: 469
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 99.19 %
Confusion Matrix
tensor([[ 978,    0,    1,    0,    0,    0,    0,    1,    0,    0],
        [   0, 1127,    1,    2,    0,    1,    1,    3,    0,    0],
        [   0,    0, 1024,    3,    1,    0,    1,    3,    0,    0],
        [   1,    0,    0, 1003,    0,    4,    0,    0,    1,    1],
        [   0,    0,    0,    0,  977,    0,    0,    0,    0,    5],
        [   2,    0,    0,    5,    0,  880,    1,    0,    1,    3],
        [   2,    3,    0,    0,    1,    3,  948,    0,    1,    0],
        [   0,    2,    3,    0,    0,    0,    0, 1019,    1,    3],
        [   1,    0,    1,    0,    0,    1,    0,    2,  967,    2],
        [   0,    0,    0,    2,    3,    4,    0,    2,    2,  996]],
       dtype=torch.int32)
===================================================================
NOTE: Only running stitch to bgonly: skipping
NOTE: not running stitch from bgonly: skipping
NOTE: Only running stitch to bgonly: skipping
Evaluate ranks and output to ./results_2n_rank/randinit3bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 3 from randinit to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 2774.21
Epoch 1, loss 1410.52
Epoch 2, loss 1098.45
Epoch 3, loss 918.80
Epoch 4, loss 805.21
Epoch 5, loss 724.01
Epoch 6, loss 665.68
Epoch 7, loss 620.80
Epoch 8, loss 581.14
Epoch 9, loss 541.02
**** Finished Training ****
Change in stitch weights: 2.8307669162750244
Largest abs weight change: 0.1975935399532318
Number of weights changing > 0.1 of that: 2658
Change in stitch bias: 0.027324175462126732
Largest abs bias change: 0.00558752566576004
Number of bias changing > 0.1 of that: 61
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 77.27 %
Confusion Matrix
tensor([[ 881,    1,    9,    0,   28,    3,   18,   38,    2,    0],
        [   1, 1058,    2,    4,   58,    0,    7,    2,    2,    1],
        [  13,    1,  844,    4,   18,    3,   34,   67,   45,    3],
        [   0,    0,   37,  807,    8,    5,   14,   14,  110,   15],
        [  40,   31,    2,    8,  629,    0,   79,  164,   24,    5],
        [   1,   10,   11,   47,   61,  669,    6,    5,   64,   18],
        [  17,    6,   12,   17,   21,    3,  866,    2,   14,    0],
        [  24,    2,   14,    9,   41,    1,   22,  860,   34,   21],
        [   6,   12,  112,   71,   56,   10,  120,   33,  464,   90],
        [  14,    6,    9,   10,   44,    6,   36,  141,   94,  649]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/randinit4bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 4 from randinit to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 2458.50
Epoch 1, loss 1023.81
Epoch 2, loss 753.82
Epoch 3, loss 617.97
Epoch 4, loss 527.42
Epoch 5, loss 477.28
Epoch 6, loss 434.48
Epoch 7, loss 399.34
Epoch 8, loss 376.62
Epoch 9, loss 355.75
**** Finished Training ****
Change in stitch weights: 2.8088741302490234
Largest abs weight change: 0.21796531975269318
Number of weights changing > 0.1 of that: 2496
Change in stitch bias: 0.025863781571388245
Largest abs bias change: 0.005682371556758881
Number of bias changing > 0.1 of that: 61
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 84.98 %
Confusion Matrix
tensor([[ 901,    1,    3,    0,   33,    0,   19,   22,    1,    0],
        [   0, 1087,    1,    3,   17,    3,   14,    1,    9,    0],
        [   9,    1,  874,   25,    9,    1,   38,   44,   31,    0],
        [   5,    0,   21,  901,   12,   11,    6,   15,   36,    3],
        [  27,   34,    0,    1,  807,    3,   28,   56,   13,   13],
        [  12,    4,    6,   47,   30,  743,   10,    1,   32,    7],
        [  35,   20,    2,    6,   30,   12,  840,    1,   12,    0],
        [  27,    4,   31,    8,   39,    2,    0,  883,    6,   28],
        [  11,    4,   42,   61,   55,   11,   91,   12,  655,   32],
        [   3,    7,    1,   13,   48,   11,   11,   61,   47,  807]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/randinit5bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 5 from randinit to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 1811.94
Epoch 1, loss 598.10
Epoch 2, loss 442.88
Epoch 3, loss 371.94
Epoch 4, loss 325.88
Epoch 5, loss 294.83
Epoch 6, loss 265.92
Epoch 7, loss 249.52
Epoch 8, loss 237.48
Epoch 9, loss 221.96
**** Finished Training ****
Change in stitch weights: 2.877772092819214
Largest abs weight change: 0.10072749853134155
Number of weights changing > 0.1 of that: 10519
Change in stitch bias: 0.02521679177880287
Largest abs bias change: 0.004013627767562866
Number of bias changing > 0.1 of that: 112
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 89.30 %
Confusion Matrix
tensor([[ 898,    0,    8,    2,   32,    2,   25,   10,    2,    1],
        [   0, 1108,    2,    3,    8,    0,    6,    1,    7,    0],
        [   3,    0,  902,   23,   21,    1,   22,   31,   29,    0],
        [   1,    1,   17,  921,    9,   16,    4,    6,   31,    4],
        [   4,    8,    2,    0,  910,    1,   16,   11,    8,   22],
        [   2,    6,    6,   33,   48,  759,   14,    1,   12,   11],
        [  10,    8,    3,    0,   27,   11,  887,    0,   12,    0],
        [   4,    4,   20,    3,   45,    0,    0,  910,   18,   24],
        [   1,    5,    9,   54,   62,   10,   17,    7,  782,   27],
        [   5,    7,    3,   12,   53,    8,    3,   30,   35,  853]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/randinit6bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 6 from randinit to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 1360.56
Epoch 1, loss 481.43
Epoch 2, loss 372.40
Epoch 3, loss 315.74
Epoch 4, loss 282.08
Epoch 5, loss 257.60
Epoch 6, loss 238.52
Epoch 7, loss 223.64
Epoch 8, loss 210.36
Epoch 9, loss 204.43
**** Finished Training ****
Change in stitch weights: 2.5235166549682617
Largest abs weight change: 0.05828305333852768
Number of weights changing > 0.1 of that: 34653
Change in stitch bias: 0.025761857628822327
Largest abs bias change: 0.0028346404433250427
Number of bias changing > 0.1 of that: 226
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 89.75 %
Confusion Matrix
tensor([[ 921,    0,   14,    0,    9,    7,   16,    5,    4,    4],
        [   0, 1115,    5,    1,    1,    1,    6,    1,    5,    0],
        [  10,    1,  936,   12,   17,    3,   11,   18,   22,    2],
        [   2,    4,   13,  894,    8,   21,    3,   15,   43,    7],
        [   2,    5,    4,    2,  908,    4,   12,    9,   12,   24],
        [   6,    3,    5,   23,   20,  786,   17,    5,   19,    8],
        [  18,   14,   10,    1,   21,   16,  867,    0,   11,    0],
        [   7,    5,   35,   11,   29,    4,    2,  895,    7,   33],
        [  11,    1,   23,   25,   38,   26,    8,   14,  805,   23],
        [   9,    6,    3,    7,   58,    7,   10,   35,   26,  848]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/randinit7bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 7 from randinit to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 747.29
Epoch 1, loss 378.44
Epoch 2, loss 321.66
Epoch 3, loss 294.85
Epoch 4, loss 278.74
Epoch 5, loss 268.48
Epoch 6, loss 259.16
Epoch 7, loss 253.54
Epoch 8, loss 251.03
Epoch 9, loss 245.10
**** Finished Training ****
Change in stitch weights: 1.87088143825531
Largest abs weight change: 0.023297011852264404
Number of weights changing > 0.1 of that: 128809
Change in stitch bias: 0.026373350992798805
Largest abs bias change: 0.002012394368648529
Number of bias changing > 0.1 of that: 453
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 84.58 %
Confusion Matrix
tensor([[ 898,    1,   11,    7,    1,   13,   18,   10,   10,   11],
        [   0, 1108,    7,    3,    2,    2,    6,    2,    2,    3],
        [  17,    7,  843,   44,   17,    5,   29,   28,   32,   10],
        [  18,    8,   34,  819,    7,   34,   16,   22,   38,   14],
        [   3,    6,   12,    2,  821,    9,   30,   25,   12,   62],
        [   9,    6,    4,   38,   13,  725,   33,   13,   32,   19],
        [  25,   11,   12,    2,   15,   30,  838,    7,   16,    2],
        [   8,   17,   22,    8,   17,    8,    1,  894,   12,   41],
        [  14,    7,   35,   60,   32,   50,   38,   18,  679,   41],
        [  20,   11,    6,   12,   40,   16,    9,   33,   29,  833]],
       dtype=torch.int32)
===================================================================
Evaluate ranks and output to ./results_2n_rank/randinit8bgonly-bw-13_2024-08-06_12-57-58_SEED60_EPOCHS4_BGN0.1_exp2e_ResNet18_bg_only_colour_mnist-test.csv
Train the stitch to a model stitched after layer 8 from randinit to bgonly
Use the bw data loader (train and test) regardless of what the models were trained on
Epoch 0, loss 771.45
Epoch 1, loss 388.63
Epoch 2, loss 326.99
Epoch 3, loss 296.11
Epoch 4, loss 279.51
Epoch 5, loss 268.99
Epoch 6, loss 260.62
Epoch 7, loss 254.71
Epoch 8, loss 249.92
Epoch 9, loss 245.73
**** Finished Training ****
Change in stitch weights: 1.908421516418457
Largest abs weight change: 0.028788000345230103
Number of weights changing > 0.1 of that: 105842
Change in stitch bias: 0.02569413371384144
Largest abs bias change: 0.002008643001317978
Number of bias changing > 0.1 of that: 448
Test the trained stitch against dataset_type='bw' data
Test Accuracy: 84.49 %
Confusion Matrix
tensor([[ 890,    3,    8,    7,    2,   11,   24,   11,   11,   13],
        [   0, 1112,    5,    4,    0,    2,    5,    1,    2,    4],
        [  19,    6,  846,   52,   16,    6,   28,   25,   26,    8],
        [   9,    8,   30,  820,    6,   38,   20,   24,   38,   17],
        [   4,    7,   11,    2,  829,   16,   27,   24,   10,   52],
        [  10,    8,    5,   48,   21,  698,   32,   12,   40,   18],
        [  22,    6,   14,    3,   13,   27,  849,    5,   16,    3],
        [   6,   18,   20,    9,   14,    7,    2,  903,   11,   38],
        [  15,    5,   34,   66,   31,   52,   40,   20,  680,   31],
        [  16,   14,    3,   18,   45,   15,   11,   34,   31,  822]],
       dtype=torch.int32)
===================================================================
NOTE: Only running stitch to bgonly: skipping
stitching_accuracies={'bw': {'bgonly': {5: 98.34, 6: 99.04, 7: 99.18, 8: 99.19}}, 'randinit': {'bgonly': {3: 77.27, 4: 84.98, 5: 89.3, 6: 89.75, 7: 84.58, 8: 84.49}}}
stitching_penalties={'bw': {'bgonly': {5: 1.6599999999999966, 6: 0.9599999999999937, 7: 0.8199999999999932, 8: 0.8100000000000023}}, 'randinit': {'bgonly': {3: 22.730000000000004, 4: 15.019999999999996, 5: 10.700000000000003, 6: 10.25, 7: 15.420000000000002, 8: 15.510000000000005}}}
bw-bgonly
original_accuracy[r_key]=100.0
Stitch Accuracy
L5: 98.34
L6: 99.04
L7: 99.18
L8: 99.19
--------------------------
randinit-bgonly
original_accuracy[r_key]=100.0
Stitch Accuracy
L3: 77.27
L4: 84.98
L5: 89.3
L6: 89.75
L7: 84.58
L8: 84.49
--------------------------
